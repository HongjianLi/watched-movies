<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>watched movies</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.8/dist/darkly/bootstrap.min.css" integrity="sha256-qK2XNHPC0d04vpmQHEb050dDEerz1tPtEEZiwzH9PFA=" crossorigin="anonymous">
	<style>
		img { height: 480px }
	</style>
</head>
<body>
	<section id="table-container" style="height:713px; overflow-y:auto;">
		<table class="table table-dark table-hover">
			<thead style="position:sticky; top:0px;">
				<tr>
					<th scope="col">date</th>
					<th scope="col">tt</th>
					<th scope="col">title</th>
					<th scope="col">year</th>
					<th scope="col">directors</th>
					<th scope="col">stars</th>
					<th scope="col">plot</th>
				</tr>
			</thead>
			<tbody id="tbody">
			</tbody>
		</table>
	</section>
	<section style="width:2554px; overflow-x:hidden;">
		<table class="table">
			<tbody>
				<tr>
					<td><img id="poster"></td>
					<td><img id="cast"></td>
					<td><video id="trailer" controls autoplay></video></td>
					<td><img id="preview"></td>
				</tr>
			</tbody>
		</table>
	</section>
	<script type="module">
document.addEventListener('DOMContentLoaded', async () => {
	const response = await fetch('movies.tsv');
	console.assert(response.ok);
	const rows = (await response.text()).split('\n').slice(1, -1).map(line => line.split('	')); // The first line is header. The last row is an empty line.
	const tbody = document.getElementById('tbody');
	rows.forEach(row => {
		const tr = document.createElement('tr');
		row.forEach((col, idx) => {
			const td = document.createElement('td');
			const text = document.createTextNode(col);
			if (idx === 1) {
				const a = document.createElement('a');
				a.setAttribute('href', `https://www.imdb.com/title/${col}/`);
				a.appendChild(text);
				td.appendChild(a);
			} else {
				td.appendChild(text);
			}
			tr.appendChild(td);
		});
		tbody.appendChild(tr);
	});
	tbody.addEventListener('click', (event) => {
		for (const tr of event.currentTarget.children) { // event.currentTarget returns <tbody>. event.currentTarget.children returns a collection of <tr>.
			tr.classList.remove('table-active');
		}
		const tr = event.target.parentNode; // event.target returns <td>. event.target.parentNode returns <tr>.
		tr.classList.add('table-active');
		const directory = `assets/${tr.children[0].innerText} ${tr.children[1].innerText}`; // tr.children returns a collection of <td>.
		document.getElementById('poster').setAttribute('src', `${directory}/poster.jpg`);
		document.getElementById('cast').setAttribute('src', `${directory}/cast.png`);
		document.getElementById('trailer').setAttribute('src', `${directory}/trailer.mp4`);
		document.getElementById('preview').setAttribute('src', `${directory}/preview.jpg`);
	});
	const container = document.getElementById('table-container');
	container.scrollTop = container.scrollHeight; // Auto scroll down the table to the bottom.
});
	</script>
</body>
</html>
